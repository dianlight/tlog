<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# tlog

```go
import "github.com/dianlight/tlog"
```

Package tlog provides enhanced structured logging capabilities with support for gitlab.com/tozd/go/errors, including colored and formatted stacktraces.

### Tozd Errors Integration

The tlog package provides special formatting for errors created with the gitlab.com/tozd/go/errors package, displaying stacktraces in a colored and structured format.

\#\# Basic Usage

```
package main

import (
    "gitlab.com/tozd/go/errors"
)

func main() {
    // Enable colors (automatic if terminal supports it)
    tlog.EnableColors(true)

    // Create an error with stack trace
    err := errors.WithStack(errors.New("something went wrong"))

    // Log the error - stacktrace will be automatically formatted
    tlog.Error("Operation failed", "error", err)

    // Add details to errors
    detailedErr := errors.WithDetails(err, "user_id", "12345", "operation", "login")
    tlog.Error("Detailed error", "error", detailedErr)

    // Chain errors
    chainedErr := errors.Wrap(detailedErr, "authentication failed")
    tlog.Error("Chained error", "error", chainedErr)
}
```

\#\# Features

- \*\*Colored Stack Traces\*\*: The most recent stack frames are highlighted in red, intermediate frames in yellow, and deeper frames in gray.

- \*\*Structured Details\*\*: Error details are displayed in a structured format under the "error.details" group.

\- \*\*Error Chains\*\*: Cause errors are displayed under "error.cause".

- \*\*Stack Frame Limiting\*\*: Stack traces are limited to 20 frames to prevent excessive output.

\#\# Configuration

```
// Enable/disable colors
tlog.EnableColors(true)

// Check if colors are enabled
if tlog.IsColorsEnabled() {
    // Colors are supported and enabled
}

// Configure formatter settings
config := tlog.FormatterConfig{
    EnableColors:      true,
    EnableFormatting:  true,
    HideSensitiveData: false,
    TimeFormat:        time.RFC3339,
}
tlog.SetFormatterConfig(config)
```

\#\# Example Output

When logging a tozd error with stack trace:

```
2025-08-07T15:14:58+02:00 ERROR main.go:15 Operation failed
  error.message="something went wrong"
  error.stacktrace.frame_0="main.go:12 main.doSomething"
  error.stacktrace.frame_1="main.go:8 main.main"
  error.stacktrace.frame_2="runtime/proc.go:250 runtime.main"
```

With colors enabled, the stack frames will be color\-coded: \- frame\_0: Red \(most recent\) \- frame\_1: Yellow \(intermediate\) \- frame\_2\+: Gray \(deeper frames\)

## Index

- [Constants](<#constants>)
- [func ClearAllCallbacks\(\)](<#ClearAllCallbacks>)
- [func ClearCallbacks\(level slog.Level\)](<#ClearCallbacks>)
- [func Debug\(msg string, args ...any\)](<#Debug>)
- [func DebugContext\(ctx context.Context, msg string, args ...any\)](<#DebugContext>)
- [func EnableColors\(enabled bool\)](<#EnableColors>)
- [func EnableMultilineStacktrace\(enabled bool\)](<#EnableMultilineStacktrace>)
- [func EnableSensitiveDataHiding\(enabled bool\)](<#EnableSensitiveDataHiding>)
- [func Error\(msg string, args ...any\)](<#Error>)
- [func ErrorContext\(ctx context.Context, msg string, args ...any\)](<#ErrorContext>)
- [func ErrorFormatter\(fieldName string\) slogformatter.Formatter](<#ErrorFormatter>)
- [func Fatal\(msg string, args ...any\)](<#Fatal>)
- [func FatalContext\(ctx context.Context, msg string, args ...any\)](<#FatalContext>)
- [func GetCallbackCount\(level slog.Level\) int](<#GetCallbackCount>)
- [func GetLevel\(\) slog.Level](<#GetLevel>)
- [func GetLevelString\(\) string](<#GetLevelString>)
- [func GetTimeFormat\(\) string](<#GetTimeFormat>)
- [func Info\(msg string, args ...any\)](<#Info>)
- [func InfoContext\(ctx context.Context, msg string, args ...any\)](<#InfoContext>)
- [func IsColorsEnabled\(\) bool](<#IsColorsEnabled>)
- [func IsLevelEnabled\(level slog.Level\) bool](<#IsLevelEnabled>)
- [func IsMultilineStacktraceEnabled\(\) bool](<#IsMultilineStacktraceEnabled>)
- [func IsSensitiveDataHidingEnabled\(\) bool](<#IsSensitiveDataHidingEnabled>)
- [func NewEventHandler\(\) slog.Handler](<#NewEventHandler>)
- [func Notice\(msg string, args ...any\)](<#Notice>)
- [func NoticeContext\(ctx context.Context, msg string, args ...any\)](<#NoticeContext>)
- [func RegisterCallback\(level slog.Level, callback LogCallback\) string](<#RegisterCallback>)
- [func RestartProcessor\(\)](<#RestartProcessor>)
- [func SetFormatterConfig\(config FormatterConfig\)](<#SetFormatterConfig>)
- [func SetLevel\(level slog.Level\)](<#SetLevel>)
- [func SetLevelFromString\(levelStr string\) error](<#SetLevelFromString>)
- [func SetTimeFormat\(format string\)](<#SetTimeFormat>)
- [func Shutdown\(\)](<#Shutdown>)
- [func TozdErrorFormatter\(\) slogformatter.Formatter](<#TozdErrorFormatter>)
- [func Trace\(msg string, args ...any\)](<#Trace>)
- [func TraceContext\(ctx context.Context, msg string, args ...any\)](<#TraceContext>)
- [func UnixTimestampFormatter\(key string\) slogformatter.Formatter](<#UnixTimestampFormatter>)
- [func UnregisterCallback\(level slog.Level, callbackID string\) bool](<#UnregisterCallback>)
- [func Warn\(msg string, args ...any\)](<#Warn>)
- [func WarnContext\(ctx context.Context, msg string, args ...any\)](<#WarnContext>)
- [func WithCaller\(\) \[\]any](<#WithCaller>)
- [func WithLevel\(level slog.Level\) \*slog.Logger](<#WithLevel>)
- [type EventHandler](<#EventHandler>)
  - [func \(h \*EventHandler\) Enabled\(\_ context.Context, \_ slog.Level\) bool](<#EventHandler.Enabled>)
  - [func \(h \*EventHandler\) Handle\(ctx context.Context, record slog.Record\) error](<#EventHandler.Handle>)
  - [func \(h \*EventHandler\) WithAttrs\(attrs \[\]slog.Attr\) slog.Handler](<#EventHandler.WithAttrs>)
  - [func \(h \*EventHandler\) WithGroup\(name string\) slog.Handler](<#EventHandler.WithGroup>)
- [type FormatterConfig](<#FormatterConfig>)
  - [func GetFormatterConfig\(\) FormatterConfig](<#GetFormatterConfig>)
- [type LogCallback](<#LogCallback>)
- [type LogEvent](<#LogEvent>)
- [type Logger](<#Logger>)
  - [func NewLogger\(\) \*Logger](<#NewLogger>)
  - [func NewLoggerWithLevel\(level slog.Level\) \*Logger](<#NewLoggerWithLevel>)
  - [func \(l \*Logger\) Fatal\(msg string, args ...any\)](<#Logger.Fatal>)
  - [func \(l \*Logger\) FatalContext\(ctx context.Context, msg string, args ...any\)](<#Logger.FatalContext>)
  - [func \(l \*Logger\) Notice\(msg string, args ...any\)](<#Logger.Notice>)
  - [func \(l \*Logger\) NoticeContext\(ctx context.Context, msg string, args ...any\)](<#Logger.NoticeContext>)
  - [func \(l \*Logger\) Trace\(msg string, args ...any\)](<#Logger.Trace>)
  - [func \(l \*Logger\) TraceContext\(ctx context.Context, msg string, args ...any\)](<#Logger.TraceContext>)


## Constants

<a name="LevelTrace"></a>Custom log levels extending slog.Level

```go
const (
    LevelTrace  slog.Level = -8
    LevelDebug  slog.Level = slog.LevelDebug
    LevelInfo   slog.Level = slog.LevelInfo
    LevelNotice slog.Level = 2
    LevelWarn   slog.Level = slog.LevelWarn
    LevelError  slog.Level = slog.LevelError
    LevelFatal  slog.Level = 12
)
```

<a name="ClearAllCallbacks"></a>
## func [ClearAllCallbacks](<https://github.com/dianlight/tlog/blob/main/tlog_event.go#L234>)

```go
func ClearAllCallbacks()
```

ClearAllCallbacks removes all registered callbacks

<a name="ClearCallbacks"></a>
## func [ClearCallbacks](<https://github.com/dianlight/tlog/blob/main/tlog_event.go#L222>)

```go
func ClearCallbacks(level slog.Level)
```

ClearCallbacks removes all callbacks for a specific level

<a name="Debug"></a>
## func [Debug](<https://github.com/dianlight/tlog/blob/main/tlog.go#L341>)

```go
func Debug(msg string, args ...any)
```

Debug logs a message at debug level

<a name="DebugContext"></a>
## func [DebugContext](<https://github.com/dianlight/tlog/blob/main/tlog.go#L366>)

```go
func DebugContext(ctx context.Context, msg string, args ...any)
```

DebugContext logs a message at debug level with context

<a name="EnableColors"></a>
## func [EnableColors](<https://github.com/dianlight/tlog/blob/main/tlog.go#L527>)

```go
func EnableColors(enabled bool)
```

EnableColors enables or disables colored output

<a name="EnableMultilineStacktrace"></a>
## func [EnableMultilineStacktrace](<https://github.com/dianlight/tlog/blob/main/tlog.go#L546>)

```go
func EnableMultilineStacktrace(enabled bool)
```

EnableMultilineStacktrace toggles multi\-line stack trace formatting.

<a name="EnableSensitiveDataHiding"></a>
## func [EnableSensitiveDataHiding](<https://github.com/dianlight/tlog/blob/main/tlog.go#L564>)

```go
func EnableSensitiveDataHiding(enabled bool)
```

EnableSensitiveDataHiding enables or disables hiding of sensitive data \(PII\)

<a name="Error"></a>
## func [Error](<https://github.com/dianlight/tlog/blob/main/tlog.go#L413>)

```go
func Error(msg string, args ...any)
```

Error logs a message at error level

<a name="ErrorContext"></a>
## func [ErrorContext](<https://github.com/dianlight/tlog/blob/main/tlog.go#L419>)

```go
func ErrorContext(ctx context.Context, msg string, args ...any)
```

ErrorContext logs a message at error level with context

<a name="ErrorFormatter"></a>
## func [ErrorFormatter](<https://github.com/dianlight/tlog/blob/main/tlog_error_formatter.go#L53>)

```go
func ErrorFormatter(fieldName string) slogformatter.Formatter
```

ErrorFormatter transforms a go error into a readable error.

Example:

```
err := reader.Close()
err = fmt.Errorf("could not close reader: %v", err)
logger.With("error", reader.Close()).Log("error")
```

passed to ErrorFormatter\("error"\), will be transformed into:

```
"error": {
  "message": "could not close reader: file already closed",
  "type": "*io.ErrClosedPipe"
}
```

<a name="Fatal"></a>
## func [Fatal](<https://github.com/dianlight/tlog/blob/main/tlog.go#L426>)

```go
func Fatal(msg string, args ...any)
```

Fatal logs a message at fatal level and exits the program

<a name="FatalContext"></a>
## func [FatalContext](<https://github.com/dianlight/tlog/blob/main/tlog.go#L433>)

```go
func FatalContext(ctx context.Context, msg string, args ...any)
```

FatalContext logs a message at fatal level with context and exits the program

<a name="GetCallbackCount"></a>
## func [GetCallbackCount](<https://github.com/dianlight/tlog/blob/main/tlog_event.go#L246>)

```go
func GetCallbackCount(level slog.Level) int
```

GetCallbackCount returns the number of callbacks registered for a level

<a name="GetLevel"></a>
## func [GetLevel](<https://github.com/dianlight/tlog/blob/main/tlog.go#L448>)

```go
func GetLevel() slog.Level
```

GetLevel returns the current minimum log level

<a name="GetLevelString"></a>
## func [GetLevelString](<https://github.com/dianlight/tlog/blob/main/tlog.go#L478>)

```go
func GetLevelString() string
```

GetLevelString returns the current log level as a string

<a name="GetTimeFormat"></a>
## func [GetTimeFormat](<https://github.com/dianlight/tlog/blob/main/tlog.go#L595>)

```go
func GetTimeFormat() string
```

GetTimeFormat returns the current time format

<a name="Info"></a>
## func [Info](<https://github.com/dianlight/tlog/blob/main/tlog.go#L373>)

```go
func Info(msg string, args ...any)
```

Info logs a message at info level

<a name="InfoContext"></a>
## func [InfoContext](<https://github.com/dianlight/tlog/blob/main/tlog.go#L379>)

```go
func InfoContext(ctx context.Context, msg string, args ...any)
```

InfoContext logs a message at info level with context

<a name="IsColorsEnabled"></a>
## func [IsColorsEnabled](<https://github.com/dianlight/tlog/blob/main/tlog.go#L539>)

```go
func IsColorsEnabled() bool
```

IsColorsEnabled returns true if colors are enabled and terminal supports them

<a name="IsLevelEnabled"></a>
## func [IsLevelEnabled](<https://github.com/dianlight/tlog/blob/main/tlog.go#L487>)

```go
func IsLevelEnabled(level slog.Level) bool
```

IsLevelEnabled checks if logging is enabled for the given level

<a name="IsMultilineStacktraceEnabled"></a>
## func [IsMultilineStacktraceEnabled](<https://github.com/dianlight/tlog/blob/main/tlog.go#L557>)

```go
func IsMultilineStacktraceEnabled() bool
```

IsMultilineStacktraceEnabled returns true if multi\-line stack traces are enabled.

<a name="IsSensitiveDataHidingEnabled"></a>
## func [IsSensitiveDataHidingEnabled](<https://github.com/dianlight/tlog/blob/main/tlog.go#L576>)

```go
func IsSensitiveDataHidingEnabled() bool
```

IsSensitiveDataHidingEnabled returns true if sensitive data hiding is enabled

<a name="NewEventHandler"></a>
## func [NewEventHandler](<https://github.com/dianlight/tlog/blob/main/tlog_event.go#L23>)

```go
func NewEventHandler() slog.Handler
```



<a name="Notice"></a>
## func [Notice](<https://github.com/dianlight/tlog/blob/main/tlog.go#L387>)

```go
func Notice(msg string, args ...any)
```

Notice logs a message at notice level

<a name="NoticeContext"></a>
## func [NoticeContext](<https://github.com/dianlight/tlog/blob/main/tlog.go#L393>)

```go
func NoticeContext(ctx context.Context, msg string, args ...any)
```

NoticeContext logs a message at notice level with context

<a name="RegisterCallback"></a>
## func [RegisterCallback](<https://github.com/dianlight/tlog/blob/main/tlog_event.go#L179>)

```go
func RegisterCallback(level slog.Level, callback LogCallback) string
```

RegisterCallback registers a callback for a specific log level Returns a callback ID that can be used to unregister the callback

<a name="RestartProcessor"></a>
## func [RestartProcessor](<https://github.com/dianlight/tlog/blob/main/tlog_event.go#L271>)

```go
func RestartProcessor()
```

RestartProcessor shuts down the current processor and creates a new one This is mainly used for testing to ensure clean state between tests

<a name="SetFormatterConfig"></a>
## func [SetFormatterConfig](<https://github.com/dianlight/tlog/blob/main/tlog.go#L507>)

```go
func SetFormatterConfig(config FormatterConfig)
```

SetFormatterConfig updates the formatter configuration and reinitializes the logger

<a name="SetLevel"></a>
## func [SetLevel](<https://github.com/dianlight/tlog/blob/main/tlog.go#L441>)

```go
func SetLevel(level slog.Level)
```

SetLevel sets the minimum log level

<a name="SetLevelFromString"></a>
## func [SetLevelFromString](<https://github.com/dianlight/tlog/blob/main/tlog.go#L457>)

```go
func SetLevelFromString(levelStr string) error
```

SetLevelFromString sets the log level from a string representation Supported levels: trace, debug, info, notice, warn/warning, error, fatal The comparison is case\-insensitive

<a name="SetTimeFormat"></a>
## func [SetTimeFormat](<https://github.com/dianlight/tlog/blob/main/tlog.go#L583>)

```go
func SetTimeFormat(format string)
```

SetTimeFormat sets the time format for log timestamps

<a name="Shutdown"></a>
## func [Shutdown](<https://github.com/dianlight/tlog/blob/main/tlog_event.go#L258>)

```go
func Shutdown()
```

Shutdown gracefully shuts down the event processor

<a name="TozdErrorFormatter"></a>
## func [TozdErrorFormatter](<https://github.com/dianlight/tlog/blob/main/tlog_error_formatter.go#L87>)

```go
func TozdErrorFormatter() slogformatter.Formatter
```

TozdErrorFormatter formats gitlab.com/tozd/go/errors with colored stacktraces

<a name="Trace"></a>
## func [Trace](<https://github.com/dianlight/tlog/blob/main/tlog.go#L328>)

```go
func Trace(msg string, args ...any)
```

Trace logs a message at trace level

<a name="TraceContext"></a>
## func [TraceContext](<https://github.com/dianlight/tlog/blob/main/tlog.go#L334>)

```go
func TraceContext(ctx context.Context, msg string, args ...any)
```

TraceContext logs a message at trace level with context

<a name="UnixTimestampFormatter"></a>
## func [UnixTimestampFormatter](<https://github.com/dianlight/tlog/blob/main/tlog_time_formatter.go#L12>)

```go
func UnixTimestampFormatter(key string) slogformatter.Formatter
```

UnixTimestampFormatter formats Unix timestamps

<a name="UnregisterCallback"></a>
## func [UnregisterCallback](<https://github.com/dianlight/tlog/blob/main/tlog_event.go#L201>)

```go
func UnregisterCallback(level slog.Level, callbackID string) bool
```

UnregisterCallback removes a callback by its ID

<a name="Warn"></a>
## func [Warn](<https://github.com/dianlight/tlog/blob/main/tlog.go#L400>)

```go
func Warn(msg string, args ...any)
```

Warn logs a message at warning level

<a name="WarnContext"></a>
## func [WarnContext](<https://github.com/dianlight/tlog/blob/main/tlog.go#L406>)

```go
func WarnContext(ctx context.Context, msg string, args ...any)
```

WarnContext logs a message at warning level with context

<a name="WithCaller"></a>
## func [WithCaller](<https://github.com/dianlight/tlog/blob/main/tlog.go#L322>)

```go
func WithCaller() []any
```

WithCaller is a helper function that adds caller information to the log args Usage: tlog.Debug\("message", tlog.WithCaller\(\)..., "key", "value"\)

<a name="WithLevel"></a>
## func [WithLevel](<https://github.com/dianlight/tlog/blob/main/tlog.go#L603>)

```go
func WithLevel(level slog.Level) *slog.Logger
```

WithLevel creates a logger with a specific minimum level This is useful for creating loggers with different levels without affecting the global logger

<a name="EventHandler"></a>
## type [EventHandler](<https://github.com/dianlight/tlog/blob/main/tlog_event.go#L19-L21>)



```go
type EventHandler struct {
    // contains filtered or unexported fields
}
```

<a name="EventHandler.Enabled"></a>
### func \(\*EventHandler\) [Enabled](<https://github.com/dianlight/tlog/blob/main/tlog_event.go#L42>)

```go
func (h *EventHandler) Enabled(_ context.Context, _ slog.Level) bool
```



<a name="EventHandler.Handle"></a>
### func \(\*EventHandler\) [Handle](<https://github.com/dianlight/tlog/blob/main/tlog_event.go#L46>)

```go
func (h *EventHandler) Handle(ctx context.Context, record slog.Record) error
```



<a name="EventHandler.WithAttrs"></a>
### func \(\*EventHandler\) [WithAttrs](<https://github.com/dianlight/tlog/blob/main/tlog_event.go#L29>)

```go
func (h *EventHandler) WithAttrs(attrs []slog.Attr) slog.Handler
```



<a name="EventHandler.WithGroup"></a>
### func \(\*EventHandler\) [WithGroup](<https://github.com/dianlight/tlog/blob/main/tlog_event.go#L33>)

```go
func (h *EventHandler) WithGroup(name string) slog.Handler
```



<a name="FormatterConfig"></a>
## type [FormatterConfig](<https://github.com/dianlight/tlog/blob/main/tlog.go#L73-L79>)

FormatterConfig holds configuration for log formatting

```go
type FormatterConfig struct {
    EnableColors        bool
    EnableFormatting    bool
    HideSensitiveData   bool
    TimeFormat          string
    MultilineStacktrace bool
}
```

<a name="GetFormatterConfig"></a>
### func [GetFormatterConfig](<https://github.com/dianlight/tlog/blob/main/tlog.go#L520>)

```go
func GetFormatterConfig() FormatterConfig
```

GetFormatterConfig returns the current formatter configuration

<a name="LogCallback"></a>
## type [LogCallback](<https://github.com/dianlight/tlog/blob/main/tlog_event.go#L78>)

LogCallback is the function signature for log event callbacks

```go
type LogCallback func(event LogEvent)
```

<a name="LogEvent"></a>
## type [LogEvent](<https://github.com/dianlight/tlog/blob/main/tlog_event.go#L14-L17>)

LogEvent represents a log event passed to callbacks

```go
type LogEvent struct {
    Record  slog.Record
    Context context.Context
}
```

<a name="Logger"></a>
## type [Logger](<https://github.com/dianlight/tlog/blob/main/tlog.go#L35-L37>)

Logger wraps slog.Logger with additional tlog functionality

```go
type Logger struct {
    *slog.Logger
}
```

<a name="NewLogger"></a>
### func [NewLogger](<https://github.com/dianlight/tlog/blob/main/tlog.go#L609>)

```go
func NewLogger() *Logger
```

NewLogger creates a new Logger instance with the default configuration

<a name="NewLoggerWithLevel"></a>
### func [NewLoggerWithLevel](<https://github.com/dianlight/tlog/blob/main/tlog.go#L616>)

```go
func NewLoggerWithLevel(level slog.Level) *Logger
```

NewLoggerWithLevel creates a new Logger instance with a specific minimum level

<a name="Logger.Fatal"></a>
### func \(\*Logger\) [Fatal](<https://github.com/dianlight/tlog/blob/main/tlog.go#L647>)

```go
func (l *Logger) Fatal(msg string, args ...any)
```

Fatal logs a message at fatal level and exits the program

<a name="Logger.FatalContext"></a>
### func \(\*Logger\) [FatalContext](<https://github.com/dianlight/tlog/blob/main/tlog.go#L654>)

```go
func (l *Logger) FatalContext(ctx context.Context, msg string, args ...any)
```

FatalContext logs a message at fatal level with context and exits the program

<a name="Logger.Notice"></a>
### func \(\*Logger\) [Notice](<https://github.com/dianlight/tlog/blob/main/tlog.go#L636>)

```go
func (l *Logger) Notice(msg string, args ...any)
```

Notice logs a message at notice level

<a name="Logger.NoticeContext"></a>
### func \(\*Logger\) [NoticeContext](<https://github.com/dianlight/tlog/blob/main/tlog.go#L642>)

```go
func (l *Logger) NoticeContext(ctx context.Context, msg string, args ...any)
```

NoticeContext logs a message at notice level with context

<a name="Logger.Trace"></a>
### func \(\*Logger\) [Trace](<https://github.com/dianlight/tlog/blob/main/tlog.go#L625>)

```go
func (l *Logger) Trace(msg string, args ...any)
```

Trace logs a message at trace level

<a name="Logger.TraceContext"></a>
### func \(\*Logger\) [TraceContext](<https://github.com/dianlight/tlog/blob/main/tlog.go#L631>)

```go
func (l *Logger) TraceContext(ctx context.Context, msg string, args ...any)
```

TraceContext logs a message at trace level with context

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
